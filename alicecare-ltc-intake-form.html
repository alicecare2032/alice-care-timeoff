<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alice Care - LTC Insurance Intake Form</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f5f5;
            color: #3D3D3D;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #F57600 0%, #FF9933 100%);
            padding: 40px 30px;
            border-radius: 12px 12px 0 0;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            border: 40px solid rgba(255, 255, 255, 0.15);
            top: -150px;
            left: -100px;
        }

        .header::after {
            content: '';
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 30px solid rgba(255, 255, 255, 0.15);
            bottom: -80px;
            right: -60px;
        }

        .logo {
            max-width: 250px;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .header-title {
            color: white;
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header-subtitle {
            color: rgba(255, 255, 255, 0.95);
            font-size: 16px;
            font-weight: 400;
            position: relative;
            z-index: 1;
        }

        .form-container {
            background: white;
            padding: 40px;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .section {
            margin-bottom: 35px;
            padding-bottom: 30px;
            border-bottom: 2px solid #E5ECF3;
        }

        .section:last-child {
            border-bottom: none;
        }

        .section-title {
            color: #1A365C;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #F57600;
            display: inline-block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #1A365C;
            font-weight: 500;
            font-size: 14px;
        }

        .required {
            color: #F57600;
            margin-left: 3px;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #D3D7DF;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            transition: all 0.3s ease;
            background-color: white;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="tel"]:focus,
        input[type="date"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #F57600;
            box-shadow: 0 0 0 3px rgba(245, 118, 0, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .row-three {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .radio-group,
        .checkbox-group {
            margin-top: 10px;
        }

        .radio-item,
        .checkbox-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 10px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }

        .radio-item:hover,
        .checkbox-item:hover {
            background-color: #E5ECF3;
        }

        input[type="radio"],
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
            accent-color: #F57600;
        }

        .radio-item label,
        .checkbox-item label {
            margin: 0;
            cursor: pointer;
            font-weight: 400;
            color: #3D3D3D;
        }

        .note-box {
            background-color: #E5ECF3;
            border-left: 4px solid #7EA1C4;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
            font-size: 13px;
            color: #1A365C;
        }

        .warning-box {
            background-color: #FCECCD;
            border-left: 4px solid #F29F07;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
            font-size: 13px;
            color: #3D3D3D;
        }

        /* Schedule Builder Styles */
        .schedule-container {
            margin-top: 20px;
        }

        .day-schedule {
            background-color: #F8F9FA;
            border: 2px solid #E5ECF3;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .day-name {
            font-size: 18px;
            font-weight: 600;
            color: #1A365C;
        }

        .day-total {
            background-color: #F57600;
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .time-slots {
            margin-bottom: 15px;
        }

        .time-slot {
            display: grid;
            grid-template-columns: 1fr 1fr auto auto;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: white;
            border-radius: 6px;
            border: 1px solid #D3D7DF;
        }

        .time-slot input {
            margin-bottom: 0;
        }

        .time-slot-duration {
            color: #1A365C;
            font-weight: 500;
            font-size: 13px;
            white-space: nowrap;
        }

        .add-slot-btn,
        .remove-slot-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-family: 'Poppins', sans-serif;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-slot-btn {
            background-color: #1A365C;
            color: white;
            width: 100%;
        }

        .add-slot-btn:hover {
            background-color: #2D5A8C;
        }

        .remove-slot-btn {
            background-color: #DC2626;
            color: white;
        }

        .remove-slot-btn:hover {
            background-color: #B91C1C;
        }

        .submit-btn {
            background: linear-gradient(135deg, #F57600 0%, #FF9933 100%);
            color: white;
            padding: 16px 40px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 118, 0, 0.3);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .success-message,
        .error-message {
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
            font-weight: 500;
        }

        .success-message {
            background-color: #D1FAE5;
            color: #065F46;
            border-left: 4px solid #10B981;
        }

        .error-message {
            background-color: #FEE2E2;
            color: #991B1B;
            border-left: 4px solid #DC2626;
        }

        #eliminationPeriodOther {
            margin-top: 10px;
            display: none;
        }

        @media (max-width: 768px) {
            .row,
            .row-three {
                grid-template-columns: 1fr;
            }

            .time-slot {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 10px;
            }

            .form-container {
                padding: 20px;
            }

            .header {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-title">LTC Insurance Intake Form</div>
            <div class="header-subtitle">Alice Care - Licensed Home Care Services</div>
        </div>

        <div class="form-container">
            <div class="success-message" id="successMessage">
                ✅ <strong>Form Submitted Successfully!</strong><br>
                Thank you for completing the intake form. You will receive a confirmation email shortly.
            </div>

            <div class="error-message" id="errorMessage">
                ❌ <strong>Submission Error</strong><br>
                There was an error submitting your form. Please try again or contact us for assistance.
            </div>

            <form id="ltcForm">
                <!-- Insurance Information -->
                <div class="section">
                    <h2 class="section-title">Insurance Information</h2>

                    <div class="form-group">
                        <label for="insurance">Insurance Company <span class="required">*</span></label>
                        <input type="text" id="insurance" name="insurance" required>
                    </div>

                    <div class="row">
                        <div class="form-group">
                            <label for="policy">Policy Number <span class="required">*</span></label>
                            <input type="text" id="policy" name="policy" required>
                        </div>
                        <div class="form-group">
                            <label for="claim">Claim Number <span class="required">*</span></label>
                            <input type="text" id="claim" name="claim" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Elimination Period <span class="required">*</span></label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="elim30" name="eliminationPeriod" value="30" required>
                                <label for="elim30">30 days</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="elim60" name="eliminationPeriod" value="60">
                                <label for="elim60">60 days</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="elim90" name="eliminationPeriod" value="90">
                                <label for="elim90">90 days</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="elimOther" name="eliminationPeriod" value="other">
                                <label for="elimOther">Other</label>
                            </div>
                        </div>
                        <div id="eliminationPeriodOther">
                            <input type="text" id="eliminationPeriodOtherText" name="eliminationOther" placeholder="Please specify elimination period">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Has Elimination Period Been Met? <span class="required">*</span></label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="elimMetYes" name="eliminationMet" value="Yes" required>
                                <label for="elimMetYes">Yes</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="elimMetNo" name="eliminationMet" value="No">
                                <label for="elimMetNo">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Maximum Spend Configuration <span class="required">*</span></label>
                        <div class="row-three">
                            <div>
                                <label for="maxSpendPeriod" style="font-size: 12px; margin-bottom: 5px;">Period</label>
                                <select id="maxSpendPeriod" name="maxSpendPeriod" required>
                                    <option value="">Select...</option>
                                    <option value="Day">Per Day</option>
                                    <option value="Week">Per Week</option>
                                    <option value="Month">Per Month</option>
                                </select>
                            </div>
                            <div>
                                <label for="maxSpendAmount" style="font-size: 12px; margin-bottom: 5px;">Amount</label>
                                <input type="number" id="maxSpendAmount" name="maxSpendAmount" step="0.01" required>
                            </div>
                            <div>
                                <label for="maxSpendUnit" style="font-size: 12px; margin-bottom: 5px;">Unit</label>
                                <select id="maxSpendUnit" name="maxSpendUnit" required>
                                    <option value="">Select...</option>
                                    <option value="USD">USD ($)</option>
                                    <option value="Hours">Hours</option>
                                    <option value="Units">Units</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="insuranceContact">Insurance Contact Information</label>
                        <input type="text" id="insuranceContact" name="insuranceContact" placeholder="Contact name, phone, email">
                    </div>
                </div>

                <!-- Client Information -->
                <div class="section">
                    <h2 class="section-title">Client Information</h2>

                    <div class="form-group">
                        <label for="insuredName">Insured Name <span class="required">*</span></label>
                        <input type="text" id="insuredName" name="insuredName" required>
                    </div>

                    <div class="row">
                        <div class="form-group">
                            <label for="dob">Date of Birth <span class="required">*</span></label>
                            <input type="date" id="dob" name="dob" required>
                        </div>
                        <div class="form-group">
                            <label for="startServiceDate">Start Service Date</label>
                            <input type="date" id="startServiceDate" name="startServiceDate">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="responsibleParty">Responsible Party <span class="required">*</span></label>
                        <input type="text" id="responsibleParty" name="responsibleParty" required>
                    </div>

                    <div class="form-group">
                        <label for="primaryDiagnose">Primary Diagnosis</label>
                        <input type="text" id="primaryDiagnose" name="primaryDiagnose">
                    </div>

                    <div class="form-group">
                        <label for="address">Address <span class="required">*</span></label>
                        <textarea id="address" name="address" rows="3" required></textarea>
                    </div>

                    <div class="row">
                        <div class="form-group">
                            <label for="email">Email <span class="required">*</span></label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone <span class="required">*</span></label>
                            <input type="tel" id="phone" name="phone" required>
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-group">
                            <label>Power of Attorney <span class="required">*</span></label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="poaYes" name="powerOfAttorney" value="Yes" required>
                                    <label for="poaYes">Yes</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="poaNo" name="powerOfAttorney" value="No">
                                    <label for="poaNo">No</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Transfer of Benefits <span class="required">*</span></label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="tobYes" name="transferOfBenefits" value="Yes" required>
                                    <label for="tobYes">Yes</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="tobNo" name="transferOfBenefits" value="No">
                                    <label for="tobNo">No</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ADL Services & Support Levels -->
                <div class="section">
                    <h2 class="section-title">ADL Services & Support Levels</h2>

                    <div class="note-box">
                        <strong>ADL Codes:</strong> TO (Toileting), EA (Eating), AM (Ambulation/Walking), TR (Transferring), 
                        CO (Cognitive), BA (Bathing), DR (Dressing), CS (Continence Support), HM (Home Management)
                    </div>

                    <div class="form-group">
                        <label>Select ADL Services Needed <span class="required">*</span></label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="adlTO" name="adlServices" value="TO">
                                <label for="adlTO">TO - Toileting</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="adlEA" name="adlServices" value="EA">
                                <label for="adlEA">EA - Eating</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="adlAM" name="adlServices" value="AM">
                                <label for="adlAM">AM - Ambulation/Walking</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="adlTR" name="adlServices" value="TR">
                                <label for="adlTR">TR - Transferring</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="adlCO" name="adlServices" value="CO">
                                <label for="adlCO">CO - Cognitive</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="adlBA" name="adlServices" value="BA">
                                <label for="adlBA">BA - Bathing</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="adlDR" name="adlServices" value="DR">
                                <label for="adlDR">DR - Dressing</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="adlCS" name="adlServices" value="CS">
                                <label for="adlCS">CS - Continence Support</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="adlHM" name="adlServices" value="HM">
                                <label for="adlHM">HM - Home Management</label>
                            </div>
                        </div>
                    </div>

                    <div class="warning-box">
                        <strong>Support Levels:</strong> Please indicate the level of assistance required for each ADL.
                    </div>

                    <!-- Bathing -->
                    <div class="form-group">
                        <label for="supportBathing">Bathing Support Level <span class="required">*</span></label>
                        <select id="supportBathing" name="supportBathing" required>
                            <option value="">Select support level...</option>
                            <option value="Independent">Independent</option>
                            <option value="Requires Supervision">Requires Supervision</option>
                            <option value="Requires limited assistance (Prompting)">Requires limited assistance (Prompting)</option>
                            <option value="Extensive assist">Extensive assist</option>
                            <option value="Total Dependence">Total Dependence</option>
                        </select>
                    </div>

                    <!-- Dressing -->
                    <div class="form-group">
                        <label for="supportDressing">Dressing Support Level <span class="required">*</span></label>
                        <select id="supportDressing" name="supportDressing" required>
                            <option value="">Select support level...</option>
                            <option value="Independent">Independent</option>
                            <option value="Requires Supervision">Requires Supervision</option>
                            <option value="Requires limited assistance (Prompting)">Requires limited assistance (Prompting)</option>
                            <option value="Extensive assist">Extensive assist</option>
                            <option value="Total Dependence">Total Dependence</option>
                        </select>
                    </div>

                    <!-- Walking -->
                    <div class="form-group">
                        <label for="supportWalking">Walking Support Level <span class="required">*</span></label>
                        <select id="supportWalking" name="supportWalking" required>
                            <option value="">Select support level...</option>
                            <option value="Independent">Independent</option>
                            <option value="Requires Supervision">Requires Supervision</option>
                            <option value="Requires limited assistance (Prompting)">Requires limited assistance (Prompting)</option>
                            <option value="Extensive assist">Extensive assist</option>
                            <option value="Total Dependence">Total Dependence</option>
                        </select>
                    </div>

                    <!-- Toileting -->
                    <div class="form-group">
                        <label for="supportToileting">Toileting Support Level <span class="required">*</span></label>
                        <select id="supportToileting" name="supportToileting" required>
                            <option value="">Select support level...</option>
                            <option value="Independent">Independent</option>
                            <option value="Requires Supervision">Requires Supervision</option>
                            <option value="Requires limited assistance (Prompting)">Requires limited assistance (Prompting)</option>
                            <option value="Extensive assist">Extensive assist</option>
                            <option value="Total Dependence">Total Dependence</option>
                        </select>
                    </div>

                    <!-- Eating -->
                    <div class="form-group">
                        <label for="supportEating">Eating Support Level <span class="required">*</span></label>
                        <select id="supportEating" name="supportEating" required>
                            <option value="">Select support level...</option>
                            <option value="Independent">Independent</option>
                            <option value="Requires Supervision">Requires Supervision</option>
                            <option value="Requires limited assistance (Prompting)">Requires limited assistance (Prompting)</option>
                            <option value="Extensive assist">Extensive assist</option>
                            <option value="Total Dependence">Total Dependence</option>
                        </select>
                    </div>

                    <!-- Transferring -->
                    <div class="form-group">
                        <label for="supportTransferring">Transferring Support Level <span class="required">*</span></label>
                        <select id="supportTransferring" name="supportTransferring" required>
                            <option value="">Select support level...</option>
                            <option value="Independent">Independent</option>
                            <option value="Requires Supervision">Requires Supervision</option>
                            <option value="Requires limited assistance (Prompting)">Requires limited assistance (Prompting)</option>
                            <option value="Extensive assist">Extensive assist</option>
                            <option value="Total Dependence">Total Dependence</option>
                        </select>
                    </div>

                    <!-- Cognitive -->
                    <div class="form-group">
                        <label for="supportCognitive">Cognitive Support Level <span class="required">*</span></label>
                        <select id="supportCognitive" name="supportCognitive" required>
                            <option value="">Select support level...</option>
                            <option value="Independent">Independent</option>
                            <option value="Requires Supervision">Requires Supervision</option>
                            <option value="Requires limited assistance (Prompting)">Requires limited assistance (Prompting)</option>
                            <option value="Extensive assist">Extensive assist</option>
                            <option value="Total Dependence">Total Dependence</option>
                        </select>
                    </div>
                </div>

                <!-- Weekly Schedule -->
                <div class="section">
                    <h2 class="section-title">Weekly Care Schedule</h2>
                    
                    <div class="note-box">
                        <strong>Instructions:</strong> Add time slots for each day. The system will automatically calculate total hours.
                    </div>

                    <div id="scheduleContainer" class="schedule-container">
                        <!-- Schedule will be generated by JavaScript -->
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="section">
                    <h2 class="section-title">Additional Information</h2>

                    <div class="form-group">
                        <label for="notes">Additional Notes</label>
                        <textarea id="notes" name="notes" rows="4" placeholder="Any additional information or special requirements..."></textarea>
                    </div>
                </div>

                <button type="submit" class="submit-btn">Submit Intake Form</button>
            </form>
        </div>
    </div>

    <script>
        // IMPORTANT: Replace this URL with your deployed Google Apps Script Web App URL
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx1bFHyc7Ddu5P_deTpjsAvpGYdpI2OeT44j3isio7oypyIHQwQLk0nSLV2K8Y6C-0/exec';

        // Days of the week
        const DAYS = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];

        // Schedule data structure
        const scheduleData = {};
        DAYS.forEach(day => {
            scheduleData[day] = {
                slots: [],
                total: 0
            };
        });

        // Initialize schedule builder
        function initializeSchedule() {
            const container = document.getElementById('scheduleContainer');
            container.innerHTML = '';

            DAYS.forEach(day => {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'day-schedule';
                dayDiv.innerHTML = `
                    <div class="day-header">
                        <div class="day-name">${day}</div>
                        <div class="day-total" id="total-${day}">0.00 hrs</div>
                    </div>
                    <div class="time-slots" id="slots-${day}"></div>
                    <button type="button" class="add-slot-btn" onclick="addTimeSlot('${day}')">+ Add Time Slot</button>
                `;
                container.appendChild(dayDiv);
            });
        }

        // Add time slot
        function addTimeSlot(day) {
            const slotsContainer = document.getElementById(`slots-${day}`);
            const slotIndex = scheduleData[day].slots.length;

            const slotDiv = document.createElement('div');
            slotDiv.className = 'time-slot';
            slotDiv.setAttribute('data-slot-index', slotIndex);
            slotDiv.innerHTML = `
                <input type="time" class="slot-start" data-day="${day}" data-index="${slotIndex}" required>
                <input type="time" class="slot-end" data-day="${day}" data-index="${slotIndex}" required>
                <div class="time-slot-duration" id="duration-${day}-${slotIndex}">0.00 hrs</div>
                <button type="button" class="remove-slot-btn" onclick="removeTimeSlot('${day}', ${slotIndex})">×</button>
            `;

            slotsContainer.appendChild(slotDiv);

            // Add event listeners
            const startInput = slotDiv.querySelector('.slot-start');
            const endInput = slotDiv.querySelector('.slot-end');

            startInput.addEventListener('change', () => updateSlotDuration(day, slotIndex));
            endInput.addEventListener('change', () => updateSlotDuration(day, slotIndex));

            // Add to schedule data
            scheduleData[day].slots.push({
                start: '',
                end: '',
                hours: 0
            });
        }

        // Update slot duration
        function updateSlotDuration(day, index) {
            const slotDiv = document.querySelector(`#slots-${day} .time-slot[data-slot-index="${index}"]`);
            const startInput = slotDiv.querySelector('.slot-start');
            const endInput = slotDiv.querySelector('.slot-end');
            const durationDiv = document.getElementById(`duration-${day}-${index}`);

            const start = startInput.value;
            const end = endInput.value;

            if (start && end) {
                const startTime = new Date(`2000-01-01T${start}`);
                const endTime = new Date(`2000-01-01T${end}`);

                let diff = (endTime - startTime) / (1000 * 60 * 60); // Convert to hours

                if (diff < 0) {
                    diff += 24; // Handle overnight shifts
                }

                scheduleData[day].slots[index] = {
                    start: start,
                    end: end,
                    hours: diff
                };

                durationDiv.textContent = `${diff.toFixed(2)} hrs`;
            } else {
                scheduleData[day].slots[index] = {
                    start: start,
                    end: end,
                    hours: 0
                };
                durationDiv.textContent = '0.00 hrs';
            }

            updateDayTotal(day);
        }

        // Update day total
        function updateDayTotal(day) {
            const total = scheduleData[day].slots.reduce((sum, slot) => sum + slot.hours, 0);
            scheduleData[day].total = total;
            document.getElementById(`total-${day}`).textContent = `${total.toFixed(2)} hrs`;
        }

        // Remove time slot
        function removeTimeSlot(day, index) {
            scheduleData[day].slots.splice(index, 1);

            const slotsContainer = document.getElementById(`slots-${day}`);
            const slotDiv = slotsContainer.querySelector(`.time-slot[data-slot-index="${index}"]`);
            slotDiv.remove();

            reindexSlots(day);
            updateDayTotal(day);
        }

        // Reindex slots after removal
        function reindexSlots(day) {
            const slotsContainer = document.getElementById(`slots-${day}`);
            const slotDivs = slotsContainer.querySelectorAll('.time-slot');

            slotDivs.forEach((slotDiv, newIndex) => {
                slotDiv.setAttribute('data-slot-index', newIndex);

                const startInput = slotDiv.querySelector('.slot-start');
                const endInput = slotDiv.querySelector('.slot-end');
                const durationDiv = slotDiv.querySelector('.time-slot-duration');
                const removeBtn = slotDiv.querySelector('.remove-slot-btn');

                startInput.setAttribute('data-index', newIndex);
                endInput.setAttribute('data-index', newIndex);
                durationDiv.id = `duration-${day}-${newIndex}`;

                if (removeBtn) {
                    removeBtn.setAttribute('onclick', `removeTimeSlot('${day}', ${newIndex})`);
                }
            });
        }

        // Show/hide "Other" elimination period input
        document.querySelectorAll('input[name="eliminationPeriod"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const otherInput = document.getElementById('eliminationPeriodOther');
                if (this.value === 'other') {
                    otherInput.style.display = 'block';
                    document.getElementById('eliminationPeriodOtherText').required = true;
                } else {
                    otherInput.style.display = 'none';
                    document.getElementById('eliminationPeriodOtherText').required = false;
                }
            });
        });

        // Helper function to format date in PST
        function formatDatePST(date) {
            const options = {
                timeZone: 'America/Los_Angeles',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            };

            const formatter = new Intl.DateTimeFormat('en-US', options);
            const parts = formatter.formatToParts(date);

            const dateParts = {};
            parts.forEach(part => {
                dateParts[part.type] = part.value;
            });

            return `${dateParts.year}-${dateParts.month}-${dateParts.day} ${dateParts.hour}:${dateParts.minute}:${dateParts.second} PST`;
        }

        // Format schedule for submission
        function formatScheduleForSubmission(day) {
            const slots = scheduleData[day].slots;
            if (slots.length === 0) return '';

            return slots.map(slot => `${slot.start}-${slot.end} (${slot.hours.toFixed(2)}hrs)`).join('; ');
        }

        // Form submission
        document.getElementById('ltcForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = document.querySelector('.submit-btn');
            const originalBtnText = submitBtn.textContent;
            submitBtn.textContent = 'Submitting...';
            submitBtn.disabled = true;

            // Collect form data
            const formData = new FormData(e.target);

            // Handle ADL Services checkboxes
            const adlCheckboxes = document.querySelectorAll('input[name="adlServices"]:checked');
            const adlValues = Array.from(adlCheckboxes).map(cb => cb.value).join(',');

            // Calculate weekly total
            const weeklyTotal = DAYS.reduce((sum, day) => sum + scheduleData[day].total, 0);

            // Create data object matching Google Sheet structure
            const data = {
                timestamp: formatDatePST(new Date()),
                insurance: formData.get('insurance'),
                policy: formData.get('policy'),
                claim: formData.get('claim'),
                eliminationPeriod: formData.get('eliminationPeriod'),
                eliminationOther: formData.get('eliminationOther') || '',
                eliminationMet: formData.get('eliminationMet'),
                maxSpendPeriod: formData.get('maxSpendPeriod'),
                maxSpendAmount: formData.get('maxSpendAmount'),
                maxSpendUnit: formData.get('maxSpendUnit'),
                insuredName: formData.get('insuredName'),
                dob: formData.get('dob'),
                responsibleParty: formData.get('responsibleParty'),
                address: formData.get('address'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                powerOfAttorney: formData.get('powerOfAttorney'),
                transferOfBenefits: formData.get('transferOfBenefits'),
                adlServices: adlValues,
                supportBathing: formData.get('supportBathing'),
                supportDressing: formData.get('supportDressing'),
                supportWalking: formData.get('supportWalking'),
                supportToileting: formData.get('supportToileting'),
                supportEating: formData.get('supportEating'),
                supportTransferring: formData.get('supportTransferring'),
                supportCognitive: formData.get('supportCognitive'),
                mondaySchedule: formatScheduleForSubmission('Monday'),
                mondayTotal: scheduleData['Monday'].total.toFixed(2),
                tuesdaySchedule: formatScheduleForSubmission('Tuesday'),
                tuesdayTotal: scheduleData['Tuesday'].total.toFixed(2),
                wednesdaySchedule: formatScheduleForSubmission('Wednesday'),
                wednesdayTotal: scheduleData['Wednesday'].total.toFixed(2),
                thursdaySchedule: formatScheduleForSubmission('Thursday'),
                thursdayTotal: scheduleData['Thursday'].total.toFixed(2),
                fridaySchedule: formatScheduleForSubmission('Friday'),
                fridayTotal: scheduleData['Friday'].total.toFixed(2),
                saturdaySchedule: formatScheduleForSubmission('Saturday'),
                saturdayTotal: scheduleData['Saturday'].total.toFixed(2),
                sundaySchedule: formatScheduleForSubmission('Sunday'),
                sundayTotal: scheduleData['Sunday'].total.toFixed(2),
                weeklyTotal: weeklyTotal.toFixed(2),
                insuranceContact: formData.get('insuranceContact') || '',
                notes: formData.get('notes') || '',
                primaryDiagnose: formData.get('primaryDiagnose') || '',
                startServiceDate: formData.get('startServiceDate') || ''
            };

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                // Show success message
                document.getElementById('successMessage').style.display = 'block';
                document.getElementById('errorMessage').style.display = 'none';

                // Reset form
                e.target.reset();

                // Reset schedule
                DAYS.forEach(day => {
                    scheduleData[day] = {
                        slots: [],
                        total: 0
                    };
                });
                initializeSchedule();

                // Scroll to success message
                document.getElementById('successMessage').scrollIntoView({ behavior: 'smooth', block: 'center' });

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('successMessage').style.display = 'none';
                document.getElementById('errorMessage').scrollIntoView({ behavior: 'smooth', block: 'center' });
            } finally {
                submitBtn.textContent = originalBtnText;
                submitBtn.disabled = false;
            }
        });

        // Initialize schedule when page loads
        window.addEventListener('load', function() {
            initializeSchedule();
        });

        // Also initialize on DOMContentLoaded as a fallback
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                if (!document.getElementById('scheduleContainer').hasChildNodes()) {
                    initializeSchedule();
                }
            });
        }
    </script>
</body>
</html>
