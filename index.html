<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Off Request v12.1</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: #E5ECF3;
            min-height: 100vh;
            padding: 20px;
        }
        
        .nav-tabs {
            max-width: 1200px;
            margin: 0 auto 20px;
            display: flex;
            gap: 10px;
            background: white;
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(26, 54, 92, 0.1);
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 14px;
            color: #1A365C;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background: #F57600;
            color: white;
        }
        
        .tab-btn:hover:not(.active) {
            background: #E5ECF3;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(26, 54, 92, 0.15);
            overflow: hidden;
        }
        
        .header {
            background: #1A365C;
            color: white;
            padding: 40px 30px;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            border: 40px solid rgba(245, 118, 0, 0.1);
            border-radius: 50%;
            top: -150px;
            right: -100px;
        }
        
        .logo {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }
        
        .logo .alice { color: #F57600; font-weight: 700; }
        .logo .dot { color: #F57600; font-weight: 700; margin: 0 -2px; }
        .logo .care { color: white; font-weight: 400; }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
            font-weight: 400;
            position: relative;
            z-index: 1;
        }
        
        .form-content {
            padding: 40px 30px;
        }
        
        .notice-box {
            background: #E5ECF3;
            border-left: 4px solid #F57600;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .notice-box h3 {
            color: #1A365C;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .notice-box p {
            color: #3D3D3D;
            font-size: 13px;
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .notice-box p:last-child { margin-bottom: 0; }
        
        .section {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 2px solid #E5ECF3;
        }
        
        .section:last-child { border-bottom: none; }
        
        .section-title {
            font-size: 18px;
            color: #1A365C;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: #F57600;
            border-radius: 2px;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: flex-end;
        }
        
        .form-group {
            margin-bottom: 0;
            flex: 1;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #1A365C;
            font-size: 14px;
        }
        
        label .required { color: #FF7475; }
        
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        input[type="time"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #D3D7DF;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
            background: white;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #F57600;
            box-shadow: 0 0 0 3px rgba(245, 118, 0, 0.1);
        }
        
        /* Day Card Styles */
        .day-card {
            background: #F9FAFB;
            border: 2px solid #E5ECF3;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            transition: border-color 0.3s;
        }
        
        .day-card:hover { border-color: #F57600; }
        
        .day-card-header {
            background: #1A365C;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .day-card-header h3 {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .day-number {
            background: #F57600;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
        }
        
        .remove-day-btn {
            background: #FF7475;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
        }
        
        .remove-day-btn:hover { background: #E55A5B; }
        
        .day-card-body { padding: 20px; }
        
        .day-info-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        /* Service Row Styles */
        .service-row {
            display: grid;
            grid-template-columns: 1fr 120px 120px 40px;
            gap: 15px;
            align-items: end;
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #E5ECF3;
        }
        
        .service-row:hover { border-color: #D3D7DF; }
        
        .remove-service-btn {
            background: transparent;
            color: #FF7475;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 6px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .remove-service-btn:hover { background: #FFE3E3; }
        
        .add-service-btn {
            background: #62B790;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .add-service-btn:hover { background: #54A07E; }
        
        .day-total {
            background: #1A365C;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }
        
        .day-total-value {
            font-size: 20px;
            font-weight: 700;
            color: #F57600;
        }
        
        .add-day-btn {
            background: #E5ECF3;
            color: #1A365C;
            border: 2px dashed #D3D7DF;
            padding: 20px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .add-day-btn:hover {
            border-color: #F57600;
            background: #FFF8F0;
        }
        
        /* Summary Box */
        .summary-box {
            background: #1A365C;
            border-radius: 12px;
            padding: 25px;
            color: white;
            margin-top: 10px;
        }
        
        .summary-box h3 {
            font-size: 16px;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        
        .summary-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .summary-item .value {
            font-size: 28px;
            font-weight: 700;
            color: #F57600;
        }
        
        .summary-item .label {
            font-size: 12px;
            opacity: 0.8;
            text-transform: uppercase;
            margin-top: 5px;
        }
        
        .captcha-container {
            margin: 30px 0;
            display: flex;
            justify-content: center;
            padding: 20px;
            background: #E5ECF3;
            border-radius: 8px;
        }
        
        .captcha-error {
            color: #FF7475;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            font-weight: 600;
            display: none;
        }
        
        .submit-btn {
            background: #F57600;
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Poppins', sans-serif;
            width: 100%;
            transition: all 0.3s;
        }
        
        .submit-btn:hover:not(:disabled) {
            background: #e06d00;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(245, 118, 0, 0.3);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .success-message {
            background: #62B790;
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-top: 20px;
            display: none;
            font-weight: 500;
        }
        
        .info-tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
        }
        
        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background: #F57600;
            color: white;
            border-radius: 50%;
            font-size: 12px;
            font-weight: 700;
            cursor: help;
            vertical-align: middle;
        }
        
        .info-tooltip .tooltip-text {
            visibility: hidden;
            width: 280px;
            background-color: #1A365C;
            color: white;
            text-align: center;
            border-radius: 8px;
            padding: 12px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -140px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 13px;
            font-weight: 400;
            line-height: 1.4;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .info-tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #1A365C transparent transparent transparent;
        }
        
        .info-tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* Dashboard Styles */
        .dashboard { display: none; }
        .dashboard.active { display: block; }
        
        .dashboard-header {
            background: #1A365C;
            color: white;
            padding: 30px;
            border-radius: 12px 12px 0 0;
        }
        
        .dashboard-header h2 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 30px;
            background: #E5ECF3;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #F57600;
        }
        
        .stat-card h3 {
            font-size: 14px;
            color: #3D3D3D;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .stat-card .number {
            font-size: 32px;
            color: #1A365C;
            font-weight: 700;
        }
        
        .requests-list { padding: 30px; }
        
        .search-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .search-filter input, .search-filter select {
            flex: 1;
            min-width: 200px;
        }
        
        /* Badge Styles */
        .badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-pending { background: #FFF3E0; color: #F57600; }
        .badge-reviewed { background: #E3F2FD; color: #2196F3; }
        .badge-approved { background: #E0F1E9; color: #62B790; }
        .badge-rejected { background: #FFE3E3; color: #FF7475; }
        
        /* Table Styles */
        .requests-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            background: white;
        }
        
        .requests-table thead {
            background: #1A365C;
            color: white;
        }
        
        .requests-table th {
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            white-space: nowrap;
        }
        
        .requests-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #E5ECF3;
            vertical-align: top;
        }
        
        .requests-table tbody tr:hover { background: #F9FAFB; }
        
        .expand-btn {
            background: #F57600;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
        }
        
        .expand-btn:hover { background: #D66600; }
        
        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(26, 54, 92, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-overlay.active { display: flex; }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #E5ECF3;
        }
        
        .modal-header h3 {
            color: #1A365C;
            font-size: 20px;
            font-weight: 600;
            margin: 0;
        }
        
        .modal-close {
            background: #FF7475;
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: #E55A5B;
            transform: rotate(90deg);
        }
        
        .modal-service-item {
            background: #F9FAFB;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #F57600;
        }
        
        .modal-service-item h4 {
            color: #1A365C;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .modal-service-details {
            display: flex;
            gap: 30px;
            font-size: 14px;
            color: #3D3D3D;
        }
        
        .modal-service-details > div { display: flex; flex-direction: column; }
        .modal-service-details label { font-weight: 500; color: #1A365C; margin-bottom: 4px; font-size: 12px; }
        .modal-service-details .value { font-weight: 600; color: #1A365C; }
        
        .modal-total {
            background: #1A365C;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 16px;
        }
        
        @media (max-width: 768px) {
            .form-row { flex-direction: column; align-items: stretch; }
            .form-group { margin-bottom: 20px; }
            .nav-tabs { flex-direction: column; }
            .stats-row { grid-template-columns: 1fr; }
            .day-info-row { grid-template-columns: 1fr; }
            .service-row { grid-template-columns: 1fr; }
            .summary-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="nav-tabs">
        <button class="tab-btn active" onclick="switchTab('form')">Submit Request</button>
        <button class="tab-btn" onclick="switchTab('myRequests')">My Requests</button>
    </div>

    <!-- FORM VIEW -->
    <div id="formView" class="container">
        <div class="header">
            <div class="logo">
                <span class="alice">alice</span><span class="dot">.</span><span class="care">care</span>
            </div>
            <h1>Time Off Request</h1>
            <p>Submit your vacation or sick time request for one or multiple days</p>
        </div>
        
        <div class="form-content">
            <div class="notice-box">
                <h3>Important Notice:</h3>
                <p>Submitting a vacation or sick leave request does not guarantee approval. Each request is reviewed based on staffing needs, accrued hours, and eligibility. Vacation and sick time are earned through accrual as outlined in the Alice Care Employee Handbook. You can view your current accrued balances and employee ID by logging into your Paychex Flex account.</p>
                <p>Incomplete forms or requests containing inaccurate information will not be processed. Please ensure all required fields are filled out correctly before submission.</p>
            </div>

            <form id="timeOffForm">
                <!-- Employee Information (entered once) -->
                <div class="section">
                    <h2 class="section-title">Employee Information</h2>
                    <div class="form-row" style="flex-wrap: wrap;">
                        <div class="form-group" style="flex: 1 1 calc(50% - 10px); margin-bottom: 20px;">
                            <label for="employeeId">
                                Employee ID <span class="required">*</span>
                                <span class="info-tooltip">
                                    <span class="info-icon">i</span>
                                    <span class="tooltip-text">Your Employee ID can be found on your Paychex paystub or in your Paychex profile</span>
                                </span>
                            </label>
                            <input type="text" id="employeeId" name="employeeId" required>
                        </div>
                        <div class="form-group" style="flex: 1 1 calc(50% - 10px); margin-bottom: 20px;">
                            <label for="employeeName">First Name <span class="required">*</span></label>
                            <input type="text" id="employeeName" name="employeeName" required>
                        </div>
                        <div class="form-group" style="flex: 1 1 calc(50% - 10px); margin-bottom: 20px;">
                            <label for="employeeLastName">Last Name <span class="required">*</span></label>
                            <input type="text" id="employeeLastName" name="employeeLastName" required>
                        </div>
                        <div class="form-group" style="flex: 1 1 calc(50% - 10px); margin-bottom: 20px;">
                            <label for="employeeEmail">Email <span class="required">*</span></label>
                            <input type="email" id="employeeEmail" name="employeeEmail" required>
                        </div>
                        <div class="form-group" style="flex: 1 1 calc(50% - 10px); margin-bottom: 20px;">
                            <label for="employeePhone">Phone Number <span class="required">*</span></label>
                            <input type="tel" id="employeePhone" name="employeePhone" required>
                        </div>
                    </div>
                </div>
                
                <!-- Days Section (multiple days) -->
                <div class="section">
                    <h2 class="section-title">Request Days</h2>
                    <p style="color: #3D3D3D; font-size: 14px; margin-bottom: 20px;">Add each day you're requesting off. Each day can have multiple services.</p>
                    
                    <div id="daysContainer">
                        <!-- Days will be added here dynamically -->
                    </div>
                    
                    <button type="button" class="add-day-btn" onclick="addDay()">
                        <span style="font-size: 20px;">+</span> Add Another Day
                    </button>
                    
                    <!-- Summary -->
                    <div class="summary-box">
                        <h3>Request Summary</h3>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <div class="value" id="summaryDays">1</div>
                                <div class="label">Days</div>
                            </div>
                            <div class="summary-item">
                                <div class="value" id="summaryServices">1</div>
                                <div class="label">Services</div>
                            </div>
                            <div class="summary-item">
                                <div class="value" id="summaryHours">0.00</div>
                                <div class="label">Total Hours</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="captcha-container">
                    <div class="g-recaptcha" data-sitekey="6LfjRvErAAAAADX6Bqb-xQr6kA1oTwAvBaGuSsi6"></div>
                </div>
                <div class="captcha-error" id="captchaError">⚠️ Please complete the reCAPTCHA verification</div>
                
                <button type="submit" class="submit-btn">Submit Request</button>
                
                <div id="successMessage" class="success-message">
                    ✓ Your request has been submitted successfully!<br>
                    <span id="generatedIds"></span><br>
                    You will receive confirmation emails shortly.
                </div>
            </form>
        </div>
    </div>

    <!-- MY REQUESTS VIEW -->
    <div id="myRequestsView" class="container dashboard">
        <div class="dashboard-header">
            <div class="logo">
                <span class="alice">alice</span><span class="dot">.</span><span class="care">care</span>
            </div>
            <h2>My Time Off Requests</h2>
            <p>View your submitted time off requests: refer to Paychex Paystub for approved</p>
        </div>
        
        <div class="stats-row">
            <div class="stat-card">
                <h3>My Total Requests</h3>
                <div class="number" id="myTotalRequests">0</div>
            </div>
            <div class="stat-card">
                <h3>My Vacation Requests</h3>
                <div class="number" id="myVacationRequests">0</div>
            </div>
            <div class="stat-card">
                <h3>My Sick Time Requests</h3>
                <div class="number" id="mySickRequests">0</div>
            </div>
        </div>
        
        <div class="notice-box" style="max-width: 800px; margin: 20px auto;">
            <h3>Status Definitions</h3>
            <p><strong>Reviewed:</strong> Time off Approved</p>
            <p><strong>Not Eligible:</strong> Not eligible for sick/vacation hours</p>
            <p><strong>Approved:</strong> Vacation/sick hours will be paid based on accrued available hours and company policy.</p>
        </div>
        
        <div class="requests-list">
            <div style="max-width: 600px; margin-bottom: 30px;">
                <h3 style="color: #1A365C; margin-bottom: 15px; font-size: 16px;">Enter Your Information to View Your Requests</h3>
                <div class="form-row" style="flex-wrap: wrap;">
                    <div class="form-group" style="flex: 1 1 calc(50% - 10px); margin-bottom: 15px;">
                        <label for="myEmployeeIdFilter">
                            Employee ID <span class="required">*</span>
                            <span class="info-tooltip">
                                <span class="info-icon">i</span>
                                <span class="tooltip-text">Your Employee ID can be found on your Paychex paystub or in your Paychex profile</span>
                            </span>
                        </label>
                        <input type="text" id="myEmployeeIdFilter" placeholder="Enter your Employee ID">
                    </div>
                    <div class="form-group" style="flex: 1 1 calc(50% - 10px); margin-bottom: 15px;">
                        <label for="myEmployeeEmailFilter">Email <span class="required">*</span></label>
                        <input type="email" id="myEmployeeEmailFilter" placeholder="Enter your Email">
                    </div>
                </div>
                <button type="button" class="submit-btn" onclick="searchMyRequests()" style="margin-top: 10px;">Search My Requests</button>
            </div>
            
            <div id="myRequestsList"></div>
        </div>
    </div>
    
    <!-- Modal for Service Details -->
    <div id="servicesModal" class="modal-overlay" onclick="if(event.target === this) closeServicesModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Services Missed on <span id="modalRequestDate"></span></h3>
                <button class="modal-close" onclick="closeServicesModal()">&times;</button>
            </div>
            <div id="modalServicesBody">
                <!-- Services will be populated here -->
            </div>
        </div>
    </div>

    <script>
        var dayCount = 0;
        var requests = [];
        var myRequests = [];
        
        // IMPORTANT: Replace with your Google Apps Script URL
        var GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby_arKrcXeBY700shcwr33m6Abp9HkMDrId4D8uMWjuJVzWKgzkGuNXNxQQsbTV7mzW/exec';
        
        // Initialize with one day
        document.addEventListener('DOMContentLoaded', function() {
            addDay();
        });
        
        function generateRequestId() {
            var timestamp = Date.now();
            var random = Math.floor(Math.random() * 1000);
            return 'AC-' + timestamp + '-' + random;
        }
        
        function addDay() {
            dayCount++;
            var container = document.getElementById('daysContainer');
            
            var dayCard = document.createElement('div');
            dayCard.className = 'day-card';
            dayCard.id = 'day-' + dayCount;
            dayCard.dataset.dayNum = dayCount;
            
            dayCard.innerHTML = 
                '<div class="day-card-header">' +
                    '<h3><span class="day-number">' + dayCount + '</span> Day ' + dayCount + '</h3>' +
                    (dayCount > 1 ? '<button type="button" class="remove-day-btn" onclick="removeDay(' + dayCount + ')">Remove Day</button>' : '') +
                '</div>' +
                '<div class="day-card-body">' +
                    '<div class="day-info-row">' +
                        '<div class="form-group">' +
                            '<label>Date <span class="required">*</span></label>' +
                            '<input type="date" class="day-date" required>' +
                        '</div>' +
                        '<div class="form-group">' +
                            '<label>Request Type <span class="required">*</span></label>' +
                            '<select class="day-type" required>' +
                                '<option value="">Select Type</option>' +
                                '<option value="vacation">Vacation</option>' +
                                '<option value="sick">Sick Time</option>' +
                            '</select>' +
                        '</div>' +
                    '</div>' +
                    '<label style="margin-bottom: 10px; display: block;">Services Missed</label>' +
                    '<div class="services-container" id="services-' + dayCount + '">' +
                        '<!-- Services will be added here -->' +
                    '</div>' +
                    '<button type="button" class="add-service-btn" onclick="addService(' + dayCount + ')">' +
                        '<span>+</span> Add Service' +
                    '</button>' +
                    '<div class="day-total">' +
                        '<span>Day Total:</span>' +
                        '<span class="day-total-value" id="day-total-' + dayCount + '">0.00 hours</span>' +
                    '</div>' +
                '</div>';
            
            container.appendChild(dayCard);
            addService(dayCount);
            updateSummary();
        }
        
        function removeDay(dayNum) {
            var dayCard = document.getElementById('day-' + dayNum);
            if (dayCard) {
                dayCard.remove();
                renumberDays();
                updateSummary();
            }
        }
        
        function renumberDays() {
            var days = document.querySelectorAll('.day-card');
            days.forEach(function(day, index) {
                var num = index + 1;
                day.querySelector('.day-number').textContent = num;
                day.querySelector('h3').innerHTML = '<span class="day-number">' + num + '</span> Day ' + num;
            });
        }
        
        function addService(dayNum) {
            var container = document.getElementById('services-' + dayNum);
            var serviceCount = container.querySelectorAll('.service-row').length + 1;
            
            var serviceRow = document.createElement('div');
            serviceRow.className = 'service-row';
            serviceRow.innerHTML = 
                '<div class="form-group">' +
                    '<label>Client Name <span class="required">*</span></label>' +
                    '<input type="text" class="service-client" placeholder="Client name" required>' +
                '</div>' +
                '<div class="form-group">' +
                    '<label>Start Time</label>' +
                    '<input type="time" class="service-time">' +
                '</div>' +
                '<div class="form-group">' +
                    '<label>Hours <span class="required">*</span></label>' +
                    '<input type="number" class="service-hours" step="0.25" min="0.25" max="24" placeholder="0.00" required oninput="updateDayTotal(' + dayNum + ')">' +
                '</div>' +
                '<button type="button" class="remove-service-btn" onclick="removeService(this, ' + dayNum + ')" ' + (serviceCount === 1 ? 'style="visibility:hidden"' : '') + '>×</button>';
            
            container.appendChild(serviceRow);
            updateRemoveButtons(container, dayNum);
            updateSummary();
        }
        
        function removeService(btn, dayNum) {
            var row = btn.closest('.service-row');
            var container = row.parentElement;
            row.remove();
            updateRemoveButtons(container, dayNum);
            updateDayTotal(dayNum);
            updateSummary();
        }
        
        function updateRemoveButtons(container, dayNum) {
            var rows = container.querySelectorAll('.service-row');
            rows.forEach(function(row) {
                var btn = row.querySelector('.remove-service-btn');
                if (btn) {
                    btn.style.visibility = rows.length === 1 ? 'hidden' : 'visible';
                }
            });
        }
        
        function updateDayTotal(dayNum) {
            var container = document.getElementById('services-' + dayNum);
            var inputs = container.querySelectorAll('.service-hours');
            var total = 0;
            
            inputs.forEach(function(input) {
                total += parseFloat(input.value) || 0;
            });
            
            document.getElementById('day-total-' + dayNum).textContent = total.toFixed(2) + ' hours';
            updateSummary();
        }
        
        function updateSummary() {
            var days = document.querySelectorAll('.day-card');
            var totalServices = 0;
            var totalHours = 0;
            
            days.forEach(function(day) {
                var services = day.querySelectorAll('.service-row');
                totalServices += services.length;
                
                services.forEach(function(service) {
                    var hours = parseFloat(service.querySelector('.service-hours').value) || 0;
                    totalHours += hours;
                });
            });
            
            document.getElementById('summaryDays').textContent = days.length;
            document.getElementById('summaryServices').textContent = totalServices;
            document.getElementById('summaryHours').textContent = totalHours.toFixed(2);
        }
        
        function switchTab(tab) {
            var formView = document.getElementById('formView');
            var myRequestsView = document.getElementById('myRequestsView');
            var tabs = document.querySelectorAll('.tab-btn');
            
            tabs.forEach(function(t) { t.classList.remove('active'); });
            
            formView.style.display = 'none';
            myRequestsView.classList.remove('active');
            
            if (tab === 'form') {
                formView.style.display = 'block';
                tabs[0].classList.add('active');
            } else if (tab === 'myRequests') {
                myRequestsView.classList.add('active');
                tabs[1].classList.add('active');
                document.getElementById('myRequestsList').innerHTML = '<p style="text-align: center; color: #3D3D3D; padding: 40px;">Enter your Employee ID and Email, then click "Search My Requests"</p>';
                loadRequestsFromSheet(function() {
                    console.log('Requests loaded successfully. Total:', requests.length);
                });
            }
        }
        
        // Form submission
        document.getElementById('timeOffForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validate reCAPTCHA
            var recaptchaResponse = grecaptcha.getResponse();
            if (!recaptchaResponse) {
                document.getElementById('captchaError').style.display = 'block';
                window.scrollTo({
                    top: document.getElementById('captchaError').offsetTop - 100,
                    behavior: 'smooth'
                });
                return;
            }
            document.getElementById('captchaError').style.display = 'none';
            
            var submitBtn = document.querySelector('.submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            
            // Get employee info
            var employeeInfo = {
                employeeId: document.getElementById('employeeId').value,
                employeeName: document.getElementById('employeeName').value,
                employeeLastName: document.getElementById('employeeLastName').value,
                employeeEmail: document.getElementById('employeeEmail').value,
                employeePhone: document.getElementById('employeePhone').value
            };
            
            // Collect all days into an array
            var days = document.querySelectorAll('.day-card');
            var daysData = [];
            var submittedIds = [];
            
            days.forEach(function(day, index) {
                var requestId = generateRequestId();
                submittedIds.push(requestId);
                
                var date = day.querySelector('.day-date').value;
                var type = day.querySelector('.day-type').value;
                var services = [];
                
                day.querySelectorAll('.service-row').forEach(function(service) {
                    services.push({
                        client: service.querySelector('.service-client').value,
                        startTime: service.querySelector('.service-time').value || 'N/A',
                        hoursMissed: service.querySelector('.service-hours').value
                    });
                });
                
                daysData.push({
                    requestId: requestId,
                    requestType: type,
                    requestDate: date,
                    services: services
                });
            });
            
            // Send all days in a single request
            var data = {
                action: 'multiday',
                employeeId: employeeInfo.employeeId,
                employeeName: employeeInfo.employeeName,
                employeeLastName: employeeInfo.employeeLastName,
                employeeEmail: employeeInfo.employeeEmail,
                employeePhone: employeeInfo.employeePhone,
                submittedDate: new Date().toISOString(),
                recaptchaToken: recaptchaResponse,
                days: daysData
            };
            
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(function() {
                document.getElementById('generatedIds').innerHTML = 'Request IDs: ' + submittedIds.join(', ');
                document.getElementById('successMessage').style.display = 'block';
                
                // Reset form
                document.getElementById('timeOffForm').reset();
                document.getElementById('daysContainer').innerHTML = '';
                dayCount = 0;
                addDay();
                
                grecaptcha.reset();
                
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Request';
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                setTimeout(function() {
                    document.getElementById('successMessage').style.display = 'none';
                }, 8000);
            })
            .catch(function(error) {
                console.error('Error:', error);
                alert('Request submitted successfully!');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Request';
            });
        });
        
        // Load requests from Google Sheets
        function loadRequestsFromSheet(callback) {
            fetch(GOOGLE_SCRIPT_URL)
                .then(function(response) {
                    return response.text();
                })
                .then(function(text) {
                    try {
                        var result = JSON.parse(text);
                        if (result.success) {
                            requests = result.requests;
                            console.log('Successfully loaded', requests.length, 'requests');
                            if (callback) callback();
                        } else {
                            console.error('Script returned success=false:', result.error);
                            alert('Error loading requests: ' + (result.error || 'Unknown error'));
                        }
                    } catch (e) {
                        console.error('Failed to parse JSON:', e);
                        alert('Error: The Google Apps Script is not returning valid data.');
                    }
                })
                .catch(function(error) {
                    console.error('Fetch error:', error);
                    alert('Network error loading requests: ' + error.message);
                });
        }
        
        function searchMyRequests() {
            var employeeId = document.getElementById('myEmployeeIdFilter').value.trim();
            var employeeEmail = document.getElementById('myEmployeeEmailFilter').value.trim().toLowerCase();
            var myRequestsList = document.getElementById('myRequestsList');
            
            if (!employeeId || !employeeEmail) {
                alert('Please enter both Employee ID and Email');
                return;
            }
            
            myRequestsList.innerHTML = '<p style="text-align: center; color: #3D3D3D; padding: 40px;">Searching for your requests...</p>';
            
            loadRequestsFromSheet(function() {
                filterMyRequests();
            });
        }
        
        function filterMyRequests() {
            var employeeId = document.getElementById('myEmployeeIdFilter').value.trim();
            var employeeEmail = document.getElementById('myEmployeeEmailFilter').value.trim().toLowerCase();
            var myRequestsList = document.getElementById('myRequestsList');
            
            if (!requests || requests.length === 0) {
                myRequestsList.innerHTML = '<p style="text-align: center; color: #3D3D3D; padding: 40px;">No requests found in the system yet.</p>';
                document.getElementById('myTotalRequests').textContent = '0';
                document.getElementById('myVacationRequests').textContent = '0';
                document.getElementById('mySickRequests').textContent = '0';
                return;
            }
            
            myRequests = [];
            for (var i = 0; i < requests.length; i++) {
                var storedId = String(requests[i].employeeId || '').trim();
                var storedEmail = String(requests[i].employeeEmail || '').trim().toLowerCase();
                
                if (storedId === employeeId && storedEmail === employeeEmail) {
                    myRequests.push(requests[i]);
                }
            }
            
            if (myRequests.length === 0) {
                myRequestsList.innerHTML = '<p style="text-align: center; color: #3D3D3D; padding: 40px;"><strong>No requests found.</strong><br><br>Please verify that both your Employee ID and Email are correct and match the information used when submitting requests.</p>';
                document.getElementById('myTotalRequests').textContent = '0';
                document.getElementById('myVacationRequests').textContent = '0';
                document.getElementById('mySickRequests').textContent = '0';
                return;
            }
            
            document.getElementById('myTotalRequests').textContent = myRequests.length;
            
            var vacCount = 0;
            var sickCount = 0;
            for (var i = 0; i < myRequests.length; i++) {
                if (myRequests[i].requestType === 'vacation') vacCount++;
                if (myRequests[i].requestType === 'sick') sickCount++;
            }
            
            document.getElementById('myVacationRequests').textContent = vacCount;
            document.getElementById('mySickRequests').textContent = sickCount;
            
            var html = '<table class="requests-table"><thead><tr>' +
                '<th>Status</th>' +
                '<th>Request Date</th>' +
                '<th>Type</th>' +
                '<th>Services</th>' +
                '<th>Review Status</th>' +
                '<th>Approval Status</th>' +
                '<th>Requested Hours</th>' +
                '<th>Approved Hours</th>' +
                '<th>Services Details</th>' +
                '<th>Submitted</th>' +
                '</tr></thead><tbody>';
            
            for (var r = 0; r < myRequests.length; r++) {
                var request = myRequests[r];
                var date = new Date(request.requestDate).toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
                var submittedDate = new Date(request.submittedDate).toLocaleDateString('en-US', { 
                    year: '2-digit', 
                    month: '2-digit', 
                    day: '2-digit'
                });
                
                var totalHours = 0;
                for (var s = 0; s < request.services.length; s++) {
                    totalHours += parseFloat(request.services[s].hoursMissed);
                }
                
                var statusBadge = '';
                if (request.rejectionStatus === 'rejected') {
                    statusBadge = '<span class="badge badge-rejected">NOT_ELIGIBLE</span>';
                } else if (request.approvalStatus === 'approved') {
                    statusBadge = '<span class="badge badge-approved">APPROVED</span>';
                } else if (request.reviewStatus === 'reviewed') {
                    statusBadge = '<span class="badge badge-reviewed">REVIEWED</span>';
                } else {
                    statusBadge = '<span class="badge badge-pending">PENDING</span>';
                }
                
                var reviewStatus = request.reviewStatus === 'reviewed' ? 
                    '<span style="color: #62B790;">✓ Reviewed</span>' : 
                    '<span style="color: #999;">Pending</span>';
                
                var approvalStatus = '';
                if (request.rejectionStatus === 'rejected') {
                    approvalStatus = '<span style="color: #FF7475;">✗ Not Eligible</span>';
                } else if (request.approvalStatus === 'approved') {
                    approvalStatus = '<span style="color: #62B790;">✓ Approved</span>';
                } else {
                    approvalStatus = '<span style="color: #999;">Pending</span>';
                }
                
                var approvedHours = (request.approvalStatus === 'approved' && request.approvedHours) ? 
                    request.approvedHours : '-';
                
                var requestType = request.requestType === 'vacation' ? 'Vacation' : 'Sick';
                
                html += '<tr>' +
                    '<td>' + statusBadge + '</td>' +
                    '<td>' + date + '</td>' +
                    '<td>' + requestType + '</td>' +
                    '<td style="text-align: center;">' + request.services.length + '</td>' +
                    '<td>' + reviewStatus + '</td>' +
                    '<td>' + approvalStatus + '</td>' +
                    '<td style="text-align: center;"><strong>' + totalHours.toFixed(2) + '</strong></td>' +
                    '<td style="text-align: center;"><strong>' + approvedHours + '</strong></td>' +
                    '<td><button class="expand-btn" onclick="toggleServices(' + r + ')">📋 View Details</button></td>' +
                    '<td style="font-size: 12px;">' + submittedDate + '</td>' +
                    '</tr>';
            }
            
            html += '</tbody></table>';
            myRequestsList.innerHTML = html;
        }
        
        function toggleServices(index) {
            var request = myRequests[index];
            var modal = document.getElementById('servicesModal');
            var modalBody = document.getElementById('modalServicesBody');
            var modalDate = document.getElementById('modalRequestDate');
            
            var date = new Date(request.requestDate).toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            });
            modalDate.textContent = date;
            
            var html = '';
            var totalHours = 0;
            for (var s = 0; s < request.services.length; s++) {
                var service = request.services[s];
                totalHours += parseFloat(service.hoursMissed);
                html += '<div class="modal-service-item">' +
                    '<h4>Service ' + (s + 1) + '</h4>' +
                    '<div class="modal-service-details">' +
                    '<div><label>Client Name</label><div class="value">' + service.client + '</div></div>' +
                    '<div><label>Start Time</label><div class="value">' + service.startTime + '</div></div>' +
                    '<div><label>Hours Missed</label><div class="value">' + service.hoursMissed + ' hours</div></div>' +
                    '</div>' +
                    '</div>';
            }
            
            html += '<div class="modal-total"><span>Total Hours for the Day</span><span>' + totalHours.toFixed(2) + ' hours</span></div>';
            
            modalBody.innerHTML = html;
            modal.classList.add('active');
        }
        
        function closeServicesModal() {
            var modal = document.getElementById('servicesModal');
            modal.classList.remove('active');
        }
    </script>
</body>
</html>
